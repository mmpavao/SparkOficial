
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

Registering imports routes...
Imports routes registered successfully
Browserslist: browsers data (caniuse-lite) is 9 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
[Session Debug] GET /api/auth/user - Session ID: pu8qGSQMF4eLgTtzOFUxblH3QF6x3u7Z, User ID: undefined
2:24:52 AM [express] GET /api/auth/user 200 in 120ms :: {"user":null,"authenticated":false}
[Session Debug] GET /api/auth/user - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:25:37 AM [express] GET /api/auth/user 304 in 386ms :: {"user":{"id":22,"companyName":"Spark Comex ‚Ä¶
[Session Debug] GET /api/notifications - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
[Session Debug] GET /api/admin/credit-applications/61 - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
Auth check - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO User ID: 22
[Session Debug] GET /api/user/financial-settings - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
[Session Debug] GET /api/user/financial-settings - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
üîç Fetching financial settings for user: 22
Authentication successful for user: 22 Role: admin
üîç PROTE√á√ÉO: admin tentando acessar /api/admin/credit-applications/61
2:25:37 AM [express] GET /api/notifications 200 in 126ms
2:25:37 AM [express] GET /api/notifications/unread-count 200 in 127ms
üë§ User data: {
  id: 22,
  defaultAdminFeeRate: null,
  defaultDownPaymentRate: null,
  defaultPaymentTerms: null
}
üí∞ Final settings being sent: {
  adminFeePercentage: 10,
  downPaymentPercentage: 30,
  paymentTerms: '30,60,90'
}
2:25:38 AM [express] GET /api/user/financial-settings 304 in 424ms :: {"adminFeePercentage":10,"down‚Ä¶
2:25:39 AM [express] GET /api/admin/credit-applications/61 200 in 1377ms :: {"id":61,"userId":32,"le‚Ä¶
[Session Debug] GET /api/credit/applications/61/credit-score - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
Auth check - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO User ID: 22
Authentication successful for user: 22 Role: admin
2:25:43 AM [express] GET /api/credit/applications/61/credit-score 404 in 1124ms :: {"message":"Credi‚Ä¶
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:25:53 AM [express] GET /api/notifications/unread-count 200 in 130ms
[Session Debug] GET /api/notifications - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:26:08 AM [express] GET /api/notifications 200 in 514ms
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:26:08 AM [express] GET /api/notifications/unread-count 200 in 483ms
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:26:24 AM [express] GET /api/notifications/unread-count 200 in 468ms
[Session Debug] GET /api/notifications - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:26:39 AM [express] GET /api/notifications 200 in 475ms
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:26:39 AM [express] GET /api/notifications/unread-count 200 in 130ms
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:26:54 AM [express] GET /api/notifications/unread-count 200 in 471ms
[Session Debug] GET /api/admin/credit-applications - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
Auth check - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO User ID: 22
Authentication successful for user: 22 Role: admin
Admin credit applications request - User: 22
Current user role: admin
Fetching fresh credit applications
Found 4 credit applications
2:26:55 AM [express] GET /api/admin/credit-applications 200 in 976ms :: [{"id":73,"userId":40,"legal‚Ä¶
[Session Debug] GET /api/credit/applications/61/credit-score - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
Auth check - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO User ID: 22
Authentication successful for user: 22 Role: admin
2:26:59 AM [express] GET /api/credit/applications/61/credit-score 404 in 1073ms :: {"message":"Credi‚Ä¶
[Session Debug] POST /api/credit/applications/61/credit-score - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
Auth check - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO User ID: 22
Authentication successful for user: 22 Role: admin
üìä Calling Receita WS API for CNPJ: 65484271000105
‚úÖ Receita WS API response received
üè¶ Calling DirectD QUOD Score API for CNPJ: 65484271000105
DirectD Score API Response Status: 404
‚ö†Ô∏è DirectD Score API call failed, status: 404
‚ùå DirectD Score API error: Error: DirectD Score API failed with status 404
    at callDirectDScoreAPI (/home/runner/workspace/server/routes.ts:6182:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes.ts:3325:26)
‚ùå DirectD Score API error: Error: DirectD Score API failed with status 404
    at callDirectDScoreAPI (/home/runner/workspace/server/routes.ts:6182:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes.ts:3325:26)
üè¢ Calling DirectD Cadastro API for CNPJ: 65484271000105
‚úÖ DirectD Cadastro API response received
‚úÖ DirectD Cadastro API data received successfully
No DirectD Score API data - using Receita WS or Cadastro API only
Error fetching credit score: TypeError: Cannot read properties of null (reading 'data')
    at <anonymous> (/home/runner/workspace/server/routes.ts:3394:26)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
2:27:05 AM [express] POST /api/credit/applications/61/credit-score 500 in 2822ms :: {"message":"Erro‚Ä¶
[Session Debug] GET /api/notifications - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:27:09 AM [express] GET /api/notifications 200 in 128ms
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22
2:27:09 AM [express] GET /api/notifications/unread-count 200 in 117ms
[Session Debug] GET /api/notifications/unread-count - Session ID: 8YkuLXpA0_rLJttYAhjpB_N8OBk_MFPO, User ID: 22